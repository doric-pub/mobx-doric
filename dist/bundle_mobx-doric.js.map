{"version":3,"file":"bundle_mobx-doric.js","sources":["../build/lib/observer.js"],"sourcesContent":["import { Group, Refreshable, Scroller } from \"doric\";\nimport { autorun } from \"mobx\";\nfunction combineView(oldV, newV) {\n    if (oldV.viewType() !== newV.viewType()) {\n        throw new Error(\"View type should be the same\");\n    }\n    for (let key in newV) {\n        let toSet = key !== \"viewId\" &&\n            key !== \"__dirty_props__\" &&\n            key !== \"callbacks\" &&\n            key !== \"nativeViewModel\" &&\n            key !== \"children\";\n        if (newV instanceof Refreshable) {\n            toSet = toSet && key !== \"content\" && key !== \"header\";\n        }\n        else if (newV instanceof Scroller) {\n            toSet = toSet && key !== \"content\";\n        }\n        if (toSet) {\n            const v = Reflect.get(newV, key, newV);\n            if (!(v instanceof Function)) {\n                Reflect.set(oldV, key, v, oldV);\n                if (key === \"_ref\") {\n                    oldV.ref = v;\n                }\n            }\n        }\n    }\n    if (newV instanceof Group) {\n        if (!(oldV instanceof Group)) {\n            throw new Error(\"View type should be the same\");\n        }\n        if (oldV.children.length !== newV.children.length) {\n            oldV.removeAllChildren();\n            newV.children.forEach((child) => oldV.addChild(child));\n        }\n        else {\n            for (let i = 0; i < oldV.children.length; i++) {\n                combineView(oldV.children[i], newV.children[i]);\n            }\n        }\n    }\n    else if (newV instanceof Refreshable) {\n        if (!(oldV instanceof Refreshable)) {\n            throw new Error(\"View type should be the same\");\n        }\n        if (oldV.header && newV.header) {\n            combineView(oldV.header, newV.header);\n        }\n        else {\n            oldV.header = newV.header;\n        }\n        combineView(oldV.content, newV.content);\n    }\n    else if (newV instanceof Scroller) {\n        if (!(oldV instanceof Scroller)) {\n            throw new Error(\"View type should be the same\");\n        }\n        combineView(oldV.content, newV.content);\n    }\n}\nexport function observer(f) {\n    let v;\n    autorun(() => {\n        const nv = f();\n        if (!!!v) {\n            v = nv;\n            return;\n        }\n        combineView(v, nv);\n    });\n    if (!v) {\n        v = f();\n        Promise.resolve().then(() => {\n            autorun(() => {\n                const nv = f();\n                if (!!!v) {\n                    v = nv;\n                    return;\n                }\n                combineView(v, nv);\n            });\n        });\n    }\n    return v;\n}\n//# sourceMappingURL=observer.js.map"],"names":["Refreshable","Scroller","Group","autorun"],"mappings":"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"}